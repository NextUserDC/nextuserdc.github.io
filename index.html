<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario con Escáner de Códigos de Barras</title>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Inventario de Productos</h1>
    </header>

    <main>
        <!-- Formulario de agregar producto -->
        <section>
            <h2>Agregar Producto</h2>
            <form id="add-product-form">
                <label for="product-name">Nombre del Producto</label>
                <input type="text" id="product-name" required placeholder="Ingrese el nombre del producto">

                <label for="product-quantity">Cantidad</label>
                <input type="number" id="product-quantity" required placeholder="Ingrese la cantidad">

                <button type="submit">Agregar Producto</button>
            </form>
            <button id="scan-button">Escanear Código de Barras</button>
            <div id="reader" style="width: 100%; max-width: 300px; height: 300px; margin-top: 15px;"></div>
        </section>

        <!-- Inventario -->
        <section id="inventory">
            <h2>Inventario</h2>
            <ul id="product-list"></ul>
        </section>
    </main>

    <footer>
        <p>© 2024 Mi Inventario</p>
    </footer>

    <script>
        // Variable global para almacenar productos
        let products = [];

        // Función para actualizar el inventario en la interfaz
        function updateInventory() {
            const productList = document.getElementById("product-list");
            productList.innerHTML = "";
            products.forEach(product => {
                const li = document.createElement("li");
                li.textContent = `${product.name} - ${product.quantity} unidades`;
                productList.appendChild(li);
            });
        }

        // Función para agregar producto
        function addProduct(name, quantity) {
            products.push({ name, quantity });
            updateInventory();
        }

        // Configuración del escáner de códigos de barras
        const html5QrCode = new Html5Qrcode("reader");

        function startScanner() {
            html5QrCode.start(
                { facingMode: { exact: "environment" } }, // Siempre usa la cámara trasera
                {
                    fps: 10, // Frames por segundo
                    qrbox: 250, // Tamaño del cuadro de detección
                },
                (decodedText) => {
                    alert(`Código escaneado: ${decodedText}`);
                    // Aquí puedes usar el código escaneado para agregar productos
                    const productName = prompt("Ingrese el nombre del producto:");
                    const productQuantity = prompt("Ingrese la cantidad:");
                    if (productName && productQuantity) {
                        addProduct(productName, parseInt(productQuantity, 10));
                    }
                    html5QrCode.stop(); // Detiene el escáner después de leer un código
                },
                (errorMessage) => {
                    console.error("Error al escanear:", errorMessage);
                }
            ).catch((err) => {
                console.error("No se pudo iniciar el escáner:", err);
                alert("Error al abrir la cámara.");
            });
        }

        // Evento de clic en el botón para comenzar el escaneo
        document.getElementById("scan-button").addEventListener("click", startScanner);

        // Manejo del formulario de agregar producto manualmente
        document.getElementById("add-product-form").addEventListener("submit", function(event) {
            event.preventDefault();
            const name = document.getElementById("product-name").value;
            const quantity = document.getElementById("product-quantity").value;
            if (name && quantity) {
                addProduct(name, parseInt(quantity, 10));
                document.getElementById("product-name").value = "";
                document.getElementById("product-quantity").value = "";
            }
        });
    </script>
</body>
</html>
